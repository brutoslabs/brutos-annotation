<?xml version="1.0" encoding="windows-1252"?>
<controllers  xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
   xmlns='http://brutos.sourceforge.net/schema/controllers'
   xmlns:context='http://brutos.sourceforge.net/schema/context'
   xsi:schemaLocation='
   http://brutos.sourceforge.net/schema/controllers http://brutos.sourceforge.net/schema/controllers/brutos-controllers-1.0.xsd
   http://brutos.sourceforge.net/schema/context http://brutos.sourceforge.net/schema/context/brutos-context-1.0.xsd'>

    <context:types>
        <context:type class-type="java.io.Serializable" factory="org.brandao.webchat.model.JSONType"/>
        <context:type class-type="java.util.List" factory="org.brandao.webchat.model.JSONType"/>
    </context:types>

    <interceptors>
        <interceptor name="checkUserInterceptor"
            class="org.brandao.webchat.controller.interceptor.CheckUserInterceptor"/>
    </interceptors>

    <controller id="/{roomID:\d+}/{invoke}.jbrs" class="org.brandao.webchat.controller.RoomController">
        
        <interceptor-ref name="checkUserInterceptor"/>
        
        <bean name="roomServiceFactory" 
            target="org.brandao.webchat.model.RoomServiceFactoryImp"/>
        
        
        <property property-name="currentUser" bean="user" scope="session"/>
        
        <property property-name="roomService">
            <bean target="org.brandao.webchat.model.RoomService"
              factory="roomServiceFactory" method-factory="getRoomService">
                  <constructor-arg>
                      <ref bean="roomID"/>
                  </constructor-arg>
            </bean>
        </property>
        
        <action id="default" view="/layout/room.jsp"/>

        <action id="login" view="/layout/login.jsp"/>

        <action id="messagePart" view="/layout/messages.jsp"/>
        
        <action id="sendPart" view="/layout/send.jsp"/>
        
        <action id="send" executor="sendMessage">
            <parameter>
                <bean target="org.brandao.webchat.controller.entity.MessageDTO">
                    <property name="origin">
                        <bean target="org.brandao.webchat.controller.entity.UserDTO">
                            <property name="nick" bean="origin">
                                <validator message="userError">
                                    <rule name="maxlength" value="30"/>
                                    <rule name="matches" value="[^\&lt;\&gt;\s]*"/>
                                </validator>
                            </property>
                        </bean>
                    </property>
                    <property name="dest">
                        <bean target="org.brandao.webchat.controller.entity.UserDTO">
                            <property name="nick" bean="dest">
                                <validator message="userError">
                                    <rule name="maxlength" value="30"/>
                                    <rule name="matches" value="[^\&lt;\&gt;\s]*"/>
                                </validator>
                            </property>
                        </bean>
                    </property>
                    <property name="message" bean="message">
                        <validator message="msgError">
                            <rule name="maxlength" value="200"/>
                            <rule name="matches" value="[^\&lt;\&gt;]*"/>
                        </validator>
                    </property>
                </bean>
            </parameter>
        </action>
        
        <action id="enter" executor="putUser" view="/layout/room.jsp">
            <parameter>
                <bean target="org.brandao.webchat.controller.entity.UserDTO">
                    <property name="nick" bean="user">
                        <validator message="msgError">
                            <rule name="minlength" value="3"/>
                            <rule name="maxlength" value="30"/>
                            <rule name="matches" value="[^\&lt;\&gt;\s]*"/>
                        </validator>
                    </property>
                </bean>
            </parameter>
            <throw-safe view="/layout/login.jsp" name="exception" 
                target="org.brandao.brutos.validator.ValidatorException"/>
            <throw-safe view="/layout/login.jsp" name="exception" 
                target="org.brandao.webchat.model.UserExistException"/>
            <throw-safe view="/layout/login.jsp" name="exception" 
                target="org.brandao.webchat.model.MaxUsersException"/>
            <throw-safe view="/layout/login.jsp" name="exception" 
                target="java.lang.NullPointerException"/>
        </action>
        
        <action id="exit" executor="removeUser">
            <parameter bean="user" scope="session"/>
        </action>

        <action id="message" executor="getMessage"/>

        <action id="listUsers" executor="getUsers"/>
        
    </controller>
</controllers>
